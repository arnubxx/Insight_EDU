document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("loginForm")!==null,y=document.getElementById("registrationForm")!==null;if(c){let i=function(){const t=r.value.trim(),s=I.value.trim();return t?t.includes("@diu.edu.bd")?s?s.length<6?(showError("Password must be at least 6 characters long"),!1):!0:(showError("Please enter your password"),!1):(showError("Please use your @diu.edu.bd email address"),!1):(showError("Please enter your email"),!1)};var h=i;const d=document.querySelectorAll(".role-tab"),v=document.getElementById("loginForm"),r=document.getElementById("emailInput"),I=document.getElementById("passwordInput"),f=document.getElementById("loginButton"),l=document.getElementById("roleInput");let n="student";d.forEach(t=>{t.addEventListener("click",function(){d.forEach(s=>{s.classList.remove("active")}),this.classList.add("active"),n=this.getAttribute("data-role"),l.value=n})}),v.addEventListener("submit",function(t){if(t.preventDefault(),!i())return;f.disabled=!0,f.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Signing In...';const s=document.createElement("input");s.type="hidden",s.name="role",s.value=n;const m=this.querySelector('input[name="role"]');m&&m!==document.getElementById("roleInput")&&m.remove();const p=document.getElementById("roleInput");p?p.value=n:this.appendChild(s),this.submit()}),[r,I].forEach(t=>{t.addEventListener("focus",function(){this.parentElement.classList.add("ring-2","ring-white/30")}),t.addEventListener("blur",function(){this.parentElement.classList.remove("ring-2","ring-white/30")})});const a=document.getElementById("googleLogin"),u=document.getElementById("githubLogin");a&&a.addEventListener("click",function(t){t.preventDefault(),window.location.href=`/auth/google?role=${n}`}),u&&u.addEventListener("click",function(t){t.preventDefault(),window.location.href=`/auth/github?role=${n}`}),document.getElementById("forgotPasswordLink")?.addEventListener("click",function(t){t.preventDefault(),showInfo("Forgot password functionality will be implemented soon!")});const g=document.getElementById("registerLink");g&&g.addEventListener("click",function(t){t.preventDefault(),window.location.href="/register"})}if(y){const d=document.getElementById("registrationForm"),v=document.querySelectorAll(".role-card"),r=document.getElementById("selectedRole"),I=document.getElementById("idField"),f=document.getElementById("idLabel"),l=document.getElementById("userId"),n=document.getElementById("student_id"),i=document.getElementById("employee_id"),a=document.getElementById("password"),u=document.getElementById("password_confirmation"),g=document.getElementById("togglePassword"),t=document.getElementById("togglePasswordConfirmation"),s=document.getElementById("submitBtn"),m=document.getElementById("submitText"),p=document.getElementById("submitLoader"),E=document.getElementById("roleError");v.forEach(o=>{o.addEventListener("click",function(){v.forEach(L=>L.classList.remove("selected")),this.classList.add("selected");const e=this.getAttribute("data-role");r.value=e,e&&(I.classList.remove("hidden"),e==="student"?(f.textContent="Student ID",l.placeholder="221-15-4716",l.setAttribute("required","required")):e==="instructor"&&(f.textContent="Employee ID",l.placeholder="EMP001",l.setAttribute("required","required")),E&&E.classList.add("hidden"))})}),g&&a&&g.addEventListener("click",function(){const o=a.getAttribute("type")==="password"?"text":"password";a.setAttribute("type",o);const e=this.querySelector("i");e&&(o==="text"?(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash")):(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye")))}),t&&u&&t.addEventListener("click",function(){const o=u.getAttribute("type")==="password"?"text":"password";u.setAttribute("type",o);const e=this.querySelector("i");e&&(o==="text"?(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye")):(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash")))}),l&&l.addEventListener("input",function(){const o=r.value,e=this.value;o==="student"?(n&&(n.value=e),i&&(i.value="")):o==="instructor"&&(i&&(i.value=e),n&&(n.value=""))}),d&&d.addEventListener("submit",function(o){if(!r||!r.value)return o.preventDefault(),E&&(E.classList.remove("hidden"),E.scrollIntoView({behavior:"smooth"})),!1;s&&(s.disabled=!0),m&&(m.textContent="Creating Account..."),p&&p.classList.remove("hidden");const e=r.value,L=l?l.value:"";e==="student"?(n&&(n.value=L),i&&(i.value="")):e==="instructor"&&(i&&(i.value=L),n&&(n.value=""))});const w=r?r.value:"";if(w){const o=document.querySelector(`[data-role="${w}"]`);o&&o.click()}}});window.authPageFunctions={showError:function(c){console.error("Auth Error:",c)},showMessage:function(c,y){console.log(`Auth ${y}:`,c)}};window.loginWithGoogle=function(c){document.querySelectorAll('button[onclick*="loginWithGoogle"]').forEach(h=>{h.disabled=!0,h.classList.add("opacity-50","cursor-not-allowed");const d=h.querySelector("span");d&&(d.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Redirecting...')}),window.location.href=`/auth/google/${c}`};
